<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Topic modeling in Gensim | ZL Wu&#39;s notebook</title>

<link rel="shortcut icon" href="https://zl-wu.github.io/favicon.ico?v=1613748384322">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://zl-wu.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <style>
    /* 导航栏样式 */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>
<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            ZL Wu&#39;s notebook
        </div>
    </div>
    <button class="navbar-toggler" id="changeNavbar" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1613748384322"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Topic modeling in Gensim
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2020-03-24 ·
                    </time>
                    
                        <a href="https://zl-wu.github.io/tag/gMp6EUZzT/" class="post-tags">
                            # gensim
                        </a>
                    
                        <a href="https://zl-wu.github.io/tag/jkstOb8bp0/" class="post-tags">
                            # topic modeling
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>&quot;Research the source code of Topic Modeling in gensim&quot;</p>
<!-- more -->
<h2 id="a-simple-example-code">A Simple Example Code</h2>
<pre><code class="language-python">from nltk.tokenize import regexp_tokenize
from nltk.corpus import stopwords
from nltk.stem import WordNetLemmatizer
lemmatizer = WordNetLemmatizer()

tokens = []
for doc in my_docs:
    words = regexp_tokenize(doc.lower(), r'[A-Za-z]+')
    words = [w for w in words if w not in stopwords.words('english')]
    words = [lemmatizer.lemmatize(w) for w in words]
    tokens.append(words)

# Gensim tf-idf
from gensim.corpora import Dictionary
from gensim.models import TfidfModel
my_dict = Dictionary(tokens)
my_dict.filter_extremes(no_below=5, no_above=0.90)
dtm = [my_dict.doc2bow(doc) for doc in tokens]
tfidf = TfidfModel(dtm)
for doc in tfidf[dtm]:
    print([[my_dict[i], np.around(freq, decimals=2)] for i, freq in doc])

'''
output:
[['advertising', 0.16], ['bbc', 0.04], ['bill', 0.05], ['book', 0.05], ....]
[['book', 0.19], ['company', 0.05], ['firm', 0.11], ['month', 0.04], ['telecom', 0.26], ....]
[['bbc', 0.09], ['moment', 0.11], ['month', 0.05], ['bos', 0.12], ['cross', 0.15], ....]
[['home', 0.06], ['play', 0.07], ['face', 0.31], ['game', 0.11], ['league', 0.1], ....]
...
'''

# Gensim: LSI
from gensim.models import LsiModel, CoherenceModel
lsi_model = LsiModel(corpus=dtm, id2word=my_dict, num_topics=5)
# lsi_model.print_topics(-1)
lsi_model.print_topics(num_topics=5, num_words=5)

# Determining optimum number of topics using coherence values 
coherence_values = []
lsi_model_list = []
min_topics, max_topics, step = 1, 5, 1
for i in range(min_topics, max_topics, step):
    lsi_model = LsiModel(dtm, id2word=my_dict, num_topics=i)
    lsi_model_list.append(lsi_model)
    coherencemodel = CoherenceModel(model=lsi_model, texts=tokens, \
        dictionary=my_dict, coherence='c_v')
    coherence_values.append(coherencemodel.get_coherence())

# Gensim: LDA
from gensim.models import LdaModel, LdaMulticore
lda_model = LdaModel(dtm, num_topics=3, id2word=my_dict, passes=10)
# lda_model.print_topics(-1)
lda_model.print_topics(num_topics=3, num_words=3)
lda_model_mc = LdaMulticore(dtm, num_topics=3, id2word=my_dict, passes=10, workers=4)
lda_model_mc.print_topics(-1)
lda_model.save('my_lda_model.lda')               # Save LDA model

# Evaluating LDA models: Topic coherence
goodLdaModel = LdaModel(corpus=dtm, id2word=my_dict, iterations=50, num_topics=2)
badLdaModel = LdaModel(corpus=dtm, id2word=my_dict, iterations=1, num_topics=2)
goodcm = CoherenceModel(model=goodLdaModel, corpus=dtm, dictionary=my_dict, coherence='u_mass')
badcm  = CoherenceModel(model=badLdaModel, corpus=dtm, dictionary=my_dict, coherence='u_mass')
goodcm.get_coherence()
badcm.get_coherence()
goodcm = CoherenceModel(model=goodLdaModel, texts=dtm, dictionary=my_dict, coherence='c_v')
badcm  = CoherenceModel(model=badLdaModel, texts=dtm, dictionary=my_dict, coherence='c_v')

# Display LDA outputs (runs only on HTML platforms like Jupyter)
import pyLDAvis.gensim              
pyLDAvis.enable_notebook()
vis = pyLDAvis.gensim.prepare(lda_model, dtm, my_dict)
pyLDAvis.display(vis)
</code></pre>
<h2 id="1-dictionary-source">1. Dictionary  <a href="https://github.com/gojomo/gensim/blob/9352dadab348fbe3c7826ed3821cac76b57ae495/gensim/corpora/dictionary.py#L28">(source)</a></h2>
<pre><code class="language-python">&gt;&gt;&gt; from gensim.corpora import Dictionary
&gt;&gt;&gt;
&gt;&gt;&gt; texts = [['human', 'interface', 'computer']]
&gt;&gt;&gt; dct = Dictionary(texts)  # initialize a Dictionary
&gt;&gt;&gt; dct.add_documents([[&quot;cat&quot;, &quot;say&quot;, &quot;meow&quot;], [&quot;dog&quot;]])  # add more document (extend the vocabulary)
&gt;&gt;&gt; dct.doc2bow([&quot;dog&quot;, &quot;computer&quot;, &quot;non_existent_word&quot;])
[(0, 1), (6, 1)]
</code></pre>
<p>The most important methods is doc2bow(['..','..',...])</p>
<pre><code class="language-python">def doc2bow(self, document, allow_update=False, return_missing=False):
    &quot;&quot;&quot;Convert `document` into the bag-of-words (BoW) format = list of `(token_id, token_count)` tuples.&quot;&quot;&quot;
    ...
    # Construct (word, frequency) mapping.
    counter = defaultdict(int)
    for w in document:
        counter[w if isinstance(w, unicode) else unicode(w, 'utf-8')] += 1
    token2id = self.token2id
    result = {token2id[w]: freq for w, freq in iteritems(counter) if w in token2id}
    ...
    result = sorted(iteritems(result))
    ...
    return result
</code></pre>
<p>doc2bow() is very similar with nltk.FreqDist(). The result returned is <strong>[(worid_id, freq),(worid_id, freq),...]</strong>.</p>
<h2 id="2-tfidfmodel-source">2. TfidfModel <a href="https://github.com/gojomo/gensim/blob/9352dadab348fbe3c7826ed3821cac76b57ae495/gensim/models/tfidfmodel.py#L249">(source)</a></h2>
<pre><code class="language-python">from gensim.models import TfidfModel

dtm = [my_dict.doc2bow(doc) for doc in tokens]
tfidf_vectorizer = TfidfModel(dtm) 
tfidf = tfidf_vectorizer[dtm]
</code></pre>
<pre><code class="language-python"># idf:
self.idfs = precompute_idfs(self.wglobal, self.dfs, self.num_docs)

print(self.wglobal)     # &lt;function gensim.models.tfidfmodel.df2idf(docfreq, totaldocs, log_base=2.0, add=0.0)&gt;

def precompute_idfs(wglobal, dfs, total_docs):
    return {termid: wglobal(df, total_docs) for termid, df in iteritems(dfs)}

def df2idf(docfreq, totaldocs, log_base=2.0, add=0.0):
    return add + np.log(float(totaldocs) / docfreq) / np.log(log_base)
</code></pre>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mi>d</mi><mi>f</mi><mo>=</mo><mn>0</mn><mo>+</mo><mfrac><mrow><mi>log</mi><mo>⁡</mo><mo>(</mo><mfrac><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>D</mi><mi>o</mi><mi>c</mi><mi>s</mi></mrow><mrow><mi>d</mi><mi>o</mi><mi>c</mi><mi>F</mi><mi>r</mi><mi>e</mi><mi>q</mi></mrow></mfrac><mo>)</mo></mrow><mrow><mi>log</mi><mo>⁡</mo><mn>2</mn></mrow></mfrac><mo>=</mo><msub><mi>log</mi><mo>⁡</mo><mn>2</mn></msub><mo>(</mo><mfrac><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>D</mi><mi>o</mi><mi>c</mi><mi>s</mi></mrow><mrow><mi>d</mi><mi>o</mi><mi>c</mi><mi>F</mi><mi>r</mi><mi>e</mi><mi>q</mi></mrow></mfrac><mo>)</mo><mo>=</mo><msub><mi>log</mi><mo>⁡</mo><mn>2</mn></msub><mo>(</mo><mfrac><mi>N</mi><msub><mi>n</mi><mi>k</mi></msub></mfrac><mo>)</mo></mrow><annotation encoding="application/x-tex">idf = 0 + \frac{\log(\frac{totalDocs}{docFreq})} {\log2} = \log_2(\frac{totalDocs}{docFreq}) = \log_2(\frac{N}{n_k}) 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.631656em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7512159999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.871108em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">q</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="mord mathdefault">o</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">o</span><span class="mord mathdefault">c</span><span class="mord mathdefault">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="language-python"># tf: dtm 
# tf-idf: as example of dtm[0]
from gensim.models import TfidfModel

termid_array, tf_array = [], []
for termid, tf in dtm[0]:
    termid_array.append(termid)
    tf_array.append(tf)

model = TfidfModel(dtm)
print(model.idfs)   # it is the idf of each token in dictionary
print(model.eps)    # 1e-12

# if a word almost appears in all documents, which makes idf of this word is very close to 0, then we remove it in tfidf.
vector = [(termid, tf * model.idfs.get(termid)) for termid, tf in zip(termid_array, tf_array) if abs(model.idfs.get(termid, 0.0)) &gt; model.eps]

# next we use l2 normalize this vector (default normalize)
length = 1.0 * math.sqrt(sum(val ** 2 for _, val in vector))
tfidf = [(termid, val/length) for termid, val in vector] 

# This is what happend behind the code &quot;model[dtm[0]]&quot;
# l1 : length = float(sum(abs(val) for _, val in vector))
# l2 : length = 1.0 * math.sqrt(sum(val ** 2 for _, val in vector))
# unique: length = 1.0 * len(vector)
</code></pre>
<p><strong>After obtaining the product of tf and idf of the current word, <u>Cosine normalization</u> is performed.</strong></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo>=</mo><mn>1.0</mn><mo>×</mo><msqrt><mrow><mo>∑</mo><mrow><mi>v</mi><mi>a</mi><msup><mi>l</mi><mn>2</mn></msup><mo>∈</mo><mi>v</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mrow></msqrt><mo>=</mo><msqrt><mrow><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></munderover><msubsup><mi>w</mi><msub><mi>i</mi><mi>k</mi></msub><mn>2</mn></msubsup></mrow></msqrt></mrow><annotation encoding="application/x-tex">length = 1.0 \times \sqrt{\sum{val^2 \in vector}} = \sqrt{\sum^{t}_{k=1}w^2_{i_k}} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.5561299999999998em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2838700000000003em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-3.2438700000000003em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5561299999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.3104239999999994em;vertical-align:-1.302113em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0083109999999995em;"><span class="svg-align" style="top:-5.270424em;"><span class="pstrut" style="height:5.270424em;"></span><span class="mord" style="padding-left:1.056em;"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.780561em;"><span style="top:-1.8478869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.302113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959079999999998em;"><span style="top:-2.423136em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3827239999999999em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.968311em;"><span class="pstrut" style="height:5.270424em;"></span><span class="hide-tail" style="min-width:0.742em;height:3.350424em;"><svg width='400em' height='3.350424em' viewBox='0 0 400000 3350' preserveAspectRatio='xMinYMin slice'><path d='M702 80H400000v40H742v3216l-4 4-4 4c-.667.7
-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667
-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155
 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.302113em;"><span></span></span></span></span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>f</mi><mi>i</mi><mi>d</mi><mi>f</mi><mo>=</mo><mfrac><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mo>∈</mo><mi>v</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">tfidf = \frac{val \in vector} {length} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>In fact, the above tfidf calculation methods are all default, that is, we can specify the calculation method according to requirements.</p>
<pre><code class="language-python"># We can modify this attribute when we create an instance of TfidfModel
class TfidfModel(interfaces.TransformationABC):
    def __init__(self, corpus=None, id2word=None, dictionary=None, wlocal=utils.identity,
                    wglobal=df2idf, normalize=True, smartirs=None, pivot=None, slope=0.25):
        ....
&quot;&quot;&quot;
smartirs : str, optional
    SMART (System for the Mechanical Analysis and Retrieval of Text) Information Retrieval System,
    a mnemonic scheme for denoting tf-idf weighting variants in the vector space model.
    The mnemonic for representing a combination of weights takes the form XYZ,
    for example 'ntc', 'bpn' and so on, where the letters represents the term weighting of the document vector.
    Term frequency weighing:
        * `b` - binary,
        * `t` or `n` - raw,
        * `a` - augmented,
        * `l` - logarithm,
        * `d` - double logarithm,
        * `L` - log average.
    Document frequency weighting:
        * `x` or `n` - none,
        * `f` - idf,
        * `t` - zero-corrected idf,
        * `p` - probabilistic idf.
    Document normalization:
        * `x` or `n` - none,
        * `c` - cosine,
        * `u` - pivoted unique,
        * `b` - pivoted character length.
    Default is 'nfc'.
    For more information visit `SMART Information Retrieval System
    &lt;https://en.wikipedia.org/wiki/SMART_Information_Retrieval_System&gt;`_.
&quot;&quot;&quot;
</code></pre>
<p><a href="https://en.wikipedia.org/wiki/SMART_Information_Retrieval_System">SMART Information Retrieval System</a></p>
<h2 id="3-lsimodel-source">3. LsiModel <a href="https://github.com/gojomo/gensim/blob/9352dadab348fbe3c7826ed3821cac76b57ae495/gensim/models/lsimodel.py#L322">(source)</a></h2>
<p>Model for Latent Semantic Indexing <a href="https://en.wikipedia.org/wiki/Latent_semantic_analysis#Latent_semantic_indexing">https://en.wikipedia.org/wiki/Latent_semantic_analysis#Latent_semantic_indexing</a></p>
<pre><code class="language-python"># Gensim: LSI
from gensim.models import LsiModel, CoherenceModel
lsi_model = LsiModel(corpus=dtm, id2word=my_dict, num_topics=5)
# lsi_model.print_topics(-1)
lsi_model.print_topics(num_topics=5, num_words=5)
</code></pre>
<pre><code class="language-python">def __init__(self, m, k, docs=None, use_svdlibc=False, power_iters=P2_EXTRA_ITERS, extra_dims=P2_EXTRA_DIMS, dtype=np.float64):

## __init__()
self.projection = Projection(
self.num_terms, self.num_topics, power_iters=self.power_iters, extra_dims=self.extra_samples, dtype=dtype
)


## add_document()
update = Projection(
self.num_terms, self.num_topics, job, extra_dims=self.extra_samples,
power_iters=self.power_iters, dtype=self.dtype
)

def stochastic_svd(corpus, rank, num_terms, chunksize=20000, extra_dims=None,
                   power_iters=0, dtype=np.float64, eps=1e-6):
    pass

u, s = stochastic_svd(
                    docs, k, chunksize=sys.maxsize,
                    num_terms=m, power_iters=self.power_iters,
                    extra_dims=self.extra_dims, dtype=dtype)
</code></pre>
<pre><code class="language-python">self.show_topics(num_topics=num_topics, num_words=num_words, log=True)

def show_topics(self, num_topics=-1, num_words=10, log=False, formatted=True):
    &quot;&quot;&quot;Get the most significant topics.
    log : bool, optional
        If True - log topics with logger.
    formatted : bool, optional
        If True - each topic represented as string, otherwise - in BoW format.
    Returns
    -------
    list of (int, str)
        If `formatted=True`, return sequence with (topic_id, string representation of topics) **OR**
    list of (int, list of (str, float))
        Otherwise, return sequence with (topic_id, [(word, value), ... ]).
    &quot;&quot;&quot;
    shown = []
    if num_topics &lt; 0:
        num_topics = self.num_topics
    for i in range(min(num_topics, self.num_topics)):
        if i &lt; len(self.projection.s):
            if formatted:
                topic = self.print_topic(i, topn=num_words)
            else:
                topic = self.show_topic(i, topn=num_words)
            shown.append((i, topic))
            if log:
                logger.info(&quot;topic #%i(%.3f): %s&quot;, i, self.projection.s[i], topic)
    return shown
</code></pre>
<h2 id="4-ldamodel">4. LdaModel</h2>
<h2 id="5-ldamulticore">5. LdaMulticore</h2>
<h2 id="6-coherencemodel">6. CoherenceModel</h2>
<h2 id="example-of-sklearn-topic-modeling">Example of sklearn topic modeling</h2>
<p><a href="https://cloud.tencent.com/developer/article/1530432">https://cloud.tencent.com/developer/article/1530432</a></p>
<pre><code class="language-python">docs = [&quot;In the middle of the night&quot;,
        &quot;When our hopes and fears collide&quot;,
        &quot;In the midst of all goodbyes&quot;,
        &quot;Where all human beings lie&quot;,
        &quot;Against another lie&quot;]
vectorizer = TfidfVectorizer()
X = vectorizer.fit_transform(docs)
terms = vectorizer.get_feature_names()
print(terms)

n_pick_topics = 3            # 设定主题数为3
lsa = TruncatedSVD(n_pick_topics)               
X2 = lsa.fit_transform(X)
X2


n_pick_docs= 2
topic_docs_id = [X2[:,t].argsort()[:-(n_pick_docs+1):-1] for t in range(n_pick_topics)]
topic_docs_id

n_pick_keywords = 4
topic_keywords_id = [lsa.components_[t].argsort()[:-(n_pick_keywords+1):-1] for t in range(n_pick_topics)]
topic_keywords_id

for t in range(n_pick_topics):
    print(&quot;topic %d:&quot; % t)
    print(&quot;    keywords: %s&quot; % &quot;, &quot;.join(terms[topic_keywords_id[t][j]] for j in range(n_pick_keywords)))
    for i in range(n_pick_docs):
        print(&quot;    doc %d&quot; % i)
        print(&quot;\t&quot;+docs[topic_docs_id[t][i]])
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://zl-wu.github.io/post/compare-nltk-and-textblobs-sentiment-analysis/" class="post-title gt-a-link">
                    Compare nltk and textblob&#39;s sentiment analysis
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">不废话，就是干</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://zl-wu.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
